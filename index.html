<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro de Fornecedores e Gestão de Empenhos</title>
  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: #f4f6f8;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1, h2, h3 {
      margin: 0 0 15px 0;
      font-weight: 700;
      color: #2c3e50;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    /* Container principal */
    .container {
      width: 100%;
      max-width: 1100px;
      background: white;
      padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    /* Formulário */
    form {
      margin-bottom: 40px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      text-transform: uppercase;
      font-size: 13px;
      color: #34495e;
    }
    input[type="text"],
    input[type="email"],
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1.8px solid #bdc3c7;
      border-radius: 6px;
      font-size: 15px;
      transition: border-color 0.3s ease;
      text-transform: uppercase;
      color: #2c3e50;
    }
    input[type="email"] {
      text-transform: none;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="number"]:focus {
      border-color: #2980b9;
      outline: none;
      box-shadow: 0 0 6px rgba(41, 128, 185, 0.4);
    }
    /* Botões */
    button.primary {
      background-color: #2980b9;
      color: white;
      border: none;
      padding: 12px 25px;
      font-weight: 700;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: background-color 0.3s ease;
      margin-top: 15px;
      user-select: none;
    }
    button.primary:hover {
      background-color: #1c5980;
    }
    button.btn-small {
      background: #e74c3c;
      border: none;
      color: white;
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 5px;
      cursor: pointer;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button.btn-small:hover {
      background: #c0392b;
    }
    button.btn-add-item {
      background-color: #27ae60;
      border: none;
      color: white;
      padding: 10px 18px;
      font-weight: 700;
      font-size: 13px;
      border-radius: 6px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button.btn-add-item:hover {
      background-color: #1e8449;
    }
    /* Lista fornecedores */
    ul#listaFornecedores {
      list-style: none;
      padding-left: 0;
      max-width: 100%;
      margin-top: 10px;
    }
    ul#listaFornecedores li {
      background: #ecf0f1;
      margin-bottom: 10px;
      padding: 15px 20px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #2c3e50;
      flex-wrap: wrap;
    }
    ul#listaFornecedores li strong {
      font-size: 16px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    ul#listaFornecedores li div {
      flex: 1 1 auto;
      min-width: 250px;
    }
    ul#listaFornecedores li button {
      flex: 0 0 auto;
      margin-left: 15px;
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow-y: auto;
      background-color: rgba(0,0,0,0.5);
      padding: 40px 20px;
      box-sizing: border-box;
    }
    .modal-content {
      background-color: #fff;
      margin: auto;
      padding: 25px 30px;
      border-radius: 12px;
      width: 100%;
      max-width: 1000px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
      animation: fadeInScale 0.3s ease forwards;
    }
    @keyframes fadeInScale {
      0% {opacity: 0; transform: scale(0.9);}
      100% {opacity: 1; transform: scale(1);}
    }
    .close-btn {
      color: #7f8c8d;
      font-size: 30px;
      font-weight: 700;
      cursor: pointer;
      position: absolute;
      right: 20px;
      top: 15px;
      user-select: none;
      transition: color 0.3s ease;
    }
    .close-btn:hover {
      color: #e74c3c;
    }
    /* Títulos seções modal */
    .section-title {
      margin-top: 25px;
      font-weight: 700;
      font-size: 18px;
      text-transform: uppercase;
      border-bottom: 3px solid #2980b9;
      padding-bottom: 6px;
      color: #34495e;
    }
    /* Flex layout para formulários */
    .flex-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .flex-col {
      flex: 1;
      min-width: 180px;
    }
    .flex-col-full {
      flex: 1 1 100%;
    }
    /* Inputs pequenos */
    .input-small {
      width: 100%;
      box-sizing: border-box;
    }
    /* Tabela */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
      color: #2c3e50;
    }
    table, th, td {
      border: 1px solid #bdc3c7;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
      vertical-align: middle;
    }
    th {
      background-color: #ecf0f1;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 1px;
    }
    td.text-right {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    td.text-center {
      text-align: center;
    }
    /* Scroll horizontal para tabelas em telas pequenas */
    .table-responsive {
      overflow-x: auto;
      margin-top: 15px;
    }
    /* Tooltip para botões */
    button[title] {
      position: relative;
    }
    button[title]:hover::after {
      content: attr(title);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #34495e;
      color: white;
      padding: 5px 8px;
      border-radius: 4px;
      white-space: nowrap;
      font-size: 12px;
      opacity: 0.9;
      pointer-events: none;
      z-index: 10;
    }
    /* Responsividade */
    @media (max-width: 768px) {
      .flex-row {
        flex-direction: column;
      }
      .flex-col {
        min-width: 100%;
      }
      ul#listaFornecedores li {
        flex-direction: column;
        align-items: flex-start;
      }
      ul#listaFornecedores li button {
        margin-left: 0;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Cadastro de Fornecedores e Gestão de Empenhos</h1>

  <section id="tab-fornecedores">
    <h2>Cadastro de Fornecedores</h2>
    <form id="formFornecedor" onsubmit="event.preventDefault(); adicionarFornecedor();">
      <div class="flex-row">
        <div class="flex-col">
          <label for="fornecedorNome">Nome Fantasia *</label>
          <input type="text" id="fornecedorNome" required placeholder="Nome Fantasia" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="fornecedorCNPJ">CNPJ *</label>
          <input type="text" id="fornecedorCNPJ" required placeholder="CNPJ (somente números)" maxlength="14" autocomplete="off" />
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-col">
          <label for="fornecedorEmail">Email *</label>
          <input type="email" id="fornecedorEmail" required placeholder="Email" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="fornecedorContato">Contato</label>
          <input type="text" id="fornecedorContato" placeholder="Contato" autocomplete="off" />
        </div>
      </div>
      <button type="submit" class="primary">Adicionar Fornecedor</button>
    </form>

    <h3>Fornecedores Cadastrados</h3>
    <ul id="listaFornecedores"></ul>
  </section>
</div>

<!-- Modal Gestão de Empenhos -->
<div id="modalEmpenhos" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
  <div class="modal-content" role="document">
    <span class="close-btn" onclick="fecharModalEmpenhos()" aria-label="Fechar">&times;</span>
    <h2 id="modalTitle">Gestão de Empenhos - <span id="modalFornecedorNome"></span></h2>

    <form id="formEmpenho" onsubmit="event.preventDefault(); adicionarEmpenho();">
      <div class="section-title">Dados do Empenho</div>
      <div class="flex-row">
        <div class="flex-col">
          <label for="numeroEmpenho">Número do Empenho *</label>
          <input type="text" id="numeroEmpenho" required autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="planoInterno">Plano Interno</label>
          <input type="text" id="planoInterno" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="notaCredito">Nota de Crédito</label>
          <input type="text" id="notaCredito" autocomplete="off" />
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-col">
          <label for="pec">PEC</label>
          <input type="text" id="pec" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="oog">O.O.G</label>
          <input type="text" id="oog" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="recurso">Recurso</label>
          <input type="text" id="recurso" autocomplete="off" />
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-col">
          <label for="descontoEmpenho">Desconto Geral (%)</label>
          <input type="number" id="descontoEmpenho" min="0" max="100" step="0.01" value="0" />
        </div>
        <div class="flex-col">
          <label for="pregao">Número do Pregão</label>
          <input type="text" id="pregao" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="itemPregao">Item Pregão</label>
          <input type="number" id="itemPregao" min="0" autocomplete="off" />
        </div>
        <div class="flex-col">
          <label for="quantidadePregao">Quantidade Pregão</label>
          <input type="number" id="quantidadePregao" min="0" autocomplete="off" />
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-col flex-col-full">
          <label for="naturezaDespesa">Natureza da Despesa</label>
          <input type="text" id="naturezaDespesa" placeholder="00.00.00" autocomplete="off" />
        </div>
      </div>

      <div class="section-title">Itens do Empenho</div>
      <div class="flex-row" style="align-items: flex-end;">
        <div class="flex-col" style="flex: 3;">
          <label for="descricaoItem">Descrição do Item *</label>
          <input type="text" id="descricaoItem" autocomplete="off" />
        </div>
        <div class="flex-col" style="flex: 1;">
          <label for="valorUnitarioItem">Valor Unitário (R$) *</label>
          <input type="number" id="valorUnitarioItem" min="0" step="0.01" />
        </div>
        <div class="flex-col" style="flex: 1;">
          <label for="descontoItem">Desconto Item (%)</label>
          <input type="number" id="descontoItem" min="0" max="100" step="0.01" value="0" />
        </div>
        <div class="flex-col" style="flex: 1;">
          <button type="button" class="btn-add-item" onclick="adicionarItemEmpenho()">Adicionar Item</button>
        </div>
      </div>

      <div class="table-responsive">
        <table id="tabelaItensEmpenho" aria-label="Itens do Empenho">
          <thead>
            <tr>
              <th>Descrição do Item</th>
              <th>Valor Unitário (R$)</th>
              <th>Desconto (%)</th>
              <th>Valor Total (R$)</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <!-- Itens adicionados aparecerão aqui -->
          </tbody>
          <tfoot>
            <tr>
              <th colspan="3" class="text-right">Valor Total do Empenho (sem desconto geral):</th>
              <th id="valorTotalItens">0,00</th>
              <th></th>
            </tr>
            <tr>
              <th colspan="3" class="text-right">Desconto Geral do Empenho (%):</th>
              <th id="descontoGeralExibido">0,00%</th>
              <th></th>
            </tr>
            <tr>
              <th colspan="3" class="text-right">Valor Total com Desconto Geral (R$):</th>
              <th id="valorTotalComDesconto">0,00</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>

      <button type="submit" class="primary" style="margin-top: 15px;">Salvar Empenho</button>
    </form>

    <div class="section-title">Empenhos Cadastrados</div>
    <div class="table-responsive">
      <table id="tabelaEmpenhos" aria-label="Empenhos cadastrados">
        <thead>
          <tr>
            <th>Número Empenho</th>
            <th>Plano Interno</th>
            <th>Nota Crédito</th>
            <th>PEC</th>
            <th>O.O.G</th>
            <th>Recurso</th>
            <th>Desconto Geral (%)</th>
            <th>Pregão</th>
            <th>Item Pregão</th>
            <th>Qtd Pregão</th>
            <th>Natureza Despesa</th>
            <th>Valor Total (R$)</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- Empenhos cadastrados aparecerão aqui -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  const fornecedores = [];

  // Força maiúsculo em inputs texto (exceto email)
  ['fornecedorNome', 'fornecedorContato', 'fornecedorCNPJ'].forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener('input', e => {
      e.target.value = e.target.value.toUpperCase();
    });
  });

  // Força maiúsculo em inputs do modal empenho (texto)
  ['numeroEmpenho', 'planoInterno', 'notaCredito', 'pec', 'oog', 'recurso', 'pregao', 'naturezaDespesa', 'descricaoItem'].forEach(id => {
    const input = document.getElementBy    id);
    input.addEventListener('input', e => {
      e.target.value = e.target.value.toUpperCase();
    });
  });

  // Validação simples do CNPJ: somente números e 14 dígitos
  function validarCNPJ(cnpj) {
    const cnpjNumeros = cnpj.replace(/\D/g, '');
    return cnpjNumeros.length === 14;
  }

  // Função para formatar número para moeda brasileira (R$)
  function formatarMoeda(valor) {
    return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  // Cadastro de fornecedor
  function adicionarFornecedor() {
    const nomeInput = document.getElementById('fornecedorNome');
    const cnpjInput = document.getElementById('fornecedorCNPJ');
    const emailInput = document.getElementById('fornecedorEmail');
    const contatoInput = document.getElementById('fornecedorContato');

    const nome = nomeInput.value.trim().toUpperCase();
    const cnpj = cnpjInput.value.trim().toUpperCase();
    const email = emailInput.value.trim().toLowerCase();
    const contato = contatoInput.value.trim().toUpperCase();

    if (!nome || !cnpj || !email) {
      alert('Preencha todos os campos obrigatórios.');
      return;
    }

    if (!validarCNPJ(cnpj)) {
      alert('CNPJ inválido. Deve conter 14 números.');
      return;
    }

    // Validação simples de email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      alert('Email inválido.');
      return;
    }

    // Verifica se já existe fornecedor com mesmo CNPJ ou email
    if (fornecedores.some(f => f.cnpj === cnpj)) {
      alert('Fornecedor com este CNPJ já cadastrado.');
      return;
    }
    if (fornecedores.some(f => f.email === email)) {
      alert('Fornecedor com este email já cadastrado.');
      return;
    }

    fornecedores.push({ nome, cnpj, email, contato, empenhos: [] });
    atualizarListaFornecedores();

    nomeInput.value = '';
    cnpjInput.value = '';
    emailInput.value = '';
    contatoInput.value = '';
  }

  // Atualiza lista de fornecedores na interface
  function atualizarListaFornecedores() {
    const lista = document.getElementById('listaFornecedores');
    lista.innerHTML = '';

    fornecedores.forEach((f, i) => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div>
          <strong>${f.nome}</strong> - CNPJ: ${f.cnpj} - Email: ${f.email} - Contato: ${f.contato || '-'}
        </div>
        <button onclick="abrirGestaoEmpenhos(${i})" aria-label="Gerenciar empenhos do fornecedor ${f.nome}">Gerenciar Empenhos</button>
      `;
      lista.appendChild(li);
    });
  }

  // Variáveis para controle do modal e fornecedor atual
  let fornecedorAtualIndex = null;
  let itensEmpenho = [];

  // Abre modal de gestão de empenhos para fornecedor selecionado
  function abrirGestaoEmpenhos(index) {
    fornecedorAtualIndex = index;
    const fornecedor = fornecedores[index];
    document.getElementById('modalFornecedorNome').textContent = fornecedor.nome;

    limparFormularioEmpenho();
    atualizarTabelaEmpenhos();

    const modal = document.getElementById('modalEmpenhos');
    modal.style.display = 'block';
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden'; // Evita scroll do fundo
  }

  // Fecha modal de gestão de empenhos
  function fecharModalEmpenhos() {
    const modal = document.getElementById('modalEmpenhos');
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = 'auto';
    fornecedorAtualIndex = null;
    itensEmpenho = [];
  }

  // Limpa formulário e itens do empenho
  function limparFormularioEmpenho() {
    const campos = ['numeroEmpenho', 'planoInterno', 'notaCredito', 'pec', 'oog', 'recurso', 'descontoEmpenho', 'pregao', 'itemPregao', 'quantidadePregao', 'naturezaDespesa'];
    campos.forEach(id => {
      const el = document.getElementById(id);
      if (el.type === 'number') el.value = el.min || 0;
      else el.value = '';
    });

    // Limpar itens do empenho
    itensEmpenho = [];
    atualizarTabelaItensEmpenho();

    // Reset campos de item
    document.getElementById('descricaoItem').value = '';
    document.getElementById('valorUnitarioItem').value = '';
    document.getElementById('descontoItem').value = '0';

    atualizarTotaisEmpenho();
  }

  // Adiciona item ao empenho
  function adicionarItemEmpenho() {
    const descricao = document.getElementById('descricaoItem').value.trim().toUpperCase();
    const valorUnitario = parseFloat(document.getElementById('valorUnitarioItem').value);
    const desconto = parseFloat(document.getElementById('descontoItem').value) || 0;

    if (!descricao) {
      alert('Descrição do item é obrigatória.');
      return;
    }
    if (isNaN(valorUnitario) || valorUnitario <= 0) {
      alert('Valor unitário deve ser maior que zero.');
      return;
    }
    if (desconto < 0 || desconto > 100) {
      alert('Desconto deve estar entre 0 e 100%.');
      return;
    }

    itensEmpenho.push({
      descricao,
      valorUnitario,
      descontoItem: desconto,
      get valorTotal() {
        return this.valorUnitario * (1 - this.descontoItem / 100);
      }
    });

    // Limpar campos do item
    document.getElementById('descricaoItem').value = '';
    document.getElementById('valorUnitarioItem').value = '';
    document.getElementById('descontoItem').value = '0';

    atualizarTabelaItensEmpenho();
    atualizarTotaisEmpenho();
  }

  // Atualiza tabela de itens do empenho
  function atualizarTabelaItensEmpenho() {
    const tbody = document.querySelector('#tabelaItensEmpenho tbody');
    tbody.innerHTML = '';

    itensEmpenho.forEach((item, index) => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${item.descricao}</td>
        <td class="text-right">${formatarMoeda(item.valorUnitario)}</td>
        <td class="text-right">${item.descontoItem.toFixed(2).replace('.', ',')}</td>
        <td class="text-right">${formatarMoeda(item.valorTotal)}</td>
        <td class="text-center">
          <button class="btn-small" onclick="removerItemEmpenho(${index})" title="Remover Item">X</button>
        </td>
      `;

      tbody.appendChild(tr);
    });
  }

  // Remove item do empenho
  function removerItemEmpenho(index) {
    if (confirm('Deseja remover este item?')) {
      itensEmpenho.splice(index, 1);
      atualizarTabelaItensEmpenho();
      atualizarTotaisEmpenho();
    }
  }

  // Atualiza totais do empenho (itens, desconto geral, total com desconto)
  function atualizarTotaisEmpenho() {
    const valorTotalItens = itensEmpenho.reduce((acc, item) => acc + item.valorTotal, 0);
    const descontoGeral = parseFloat(document.getElementById('descontoEmpenho').value) || 0;
    const valorComDesconto = valorTotalItens * (1 - descontoGeral / 100);

    document.getElementById('valorTotalItens').textContent = formatarMoeda(valorTotalItens);
    document.getElementById('descontoGeralExibido').textContent = descontoGeral.toFixed(2).replace('.', ',') + '%';
    document.getElementById('valorTotalComDesconto').textContent = formatarMoeda(valorComDesconto);
  }

  // Atualiza totais ao mudar desconto geral
  document.getElementById('descontoEmpenho').addEventListener('input', atualizarTotaisEmpenho);

  // Adiciona empenho ao fornecedor
  function adicionarEmpenho() {
    if (fornecedorAtualIndex === null) {
      alert('Fornecedor não selecionado.');
      return;
    }

    const numeroEmpenho = document.getElementById('numeroEmpenho').value.trim().toUpperCase();
    if (!numeroEmpenho) {
      alert('Número do empenho é obrigatório.');
      return;
    }
    if (itensEmpenho.length === 0) {
      alert('Adicione pelo menos um item ao empenho.');
      return;
    }

    const planoInterno = document.getElementById('planoInterno').value.trim().toUpperCase();
    const notaCredito = document.getElementById('notaCredito').value.trim().toUpperCase();
    const pec = document.getElementById('pec').value.trim().toUpperCase();
    const oog = document.getElementById('oog').value.trim().toUpperCase();
    const recurso = document.getElementById('recurso').value.trim().toUpperCase();
    const descontoEmpenho = parseFloat(document.getElementById('descontoEmpenho').value) || 0;
    const pregao = document.getElementById('pregao').value.trim().toUpperCase();
    const itemPregao = parseInt(document.getElementById('itemPregao').value) || 0;
    const quantidadePregao = parseInt(document.getElementById('quantidadePregao').value) || 0;
    const naturezaDespesa = document.getElementById('naturezaDespesa').value.trim().toUpperCase();

    const fornecedor = fornecedores[fornecedorAtualIndex];
    if (fornecedor.empenhos.some(e => e.numeroEmpenho === numeroEmpenho)) {
      alert('Empenho com este número já cadastrado para este fornecedor.');
      return;
    }

    const empenho = {
      numeroEmpenho,
      planoInterno,
      notaCredito,
      pec,
      oog,
      recurso,
      desconto: descontoEmpenho,
      pregao,
      itemPregao,
      quantidadePregao,
      naturezaDespesa,
      itens: [...itensEmpenho],
      get valorTotalEmpenho() {
        const totalItens = this.itens.reduce((acc, item) => acc + item.valorTotal, 0);
        return totalItens * (1 - this.desconto / 100);
      }
    };

    fornecedor.empenhos.push(empenho);

    atualizarTabelaEmpenhos();
    limparFormularioEmpenho();

    alert('Empenho cadastrado com sucesso!');
  }

  // Atualiza tabela de empenhos do fornecedor atual
  function atualizarTabelaEmpenhos() {
    if (fornecedorAtualIndex === null) return;

    const fornecedor = fornecedores[fornecedorAtualIndex];
    const tbody = document.querySelector('#tabelaEmpenhos tbody');
    tbody.innerHTML = '';

    fornecedor.empenhos.forEach((e, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${e.numeroEmpenho}</td>
        <td>${e.planoInterno || '-'}</td>
        <td>${e.notaCredito || '-'}</td>
        <td>${e.pec || '-'}</td>
        <td>${e.oog || '-'}</td>
        <td>${e.recurso || '-'}</td>
        <td class="text-right">${e.desconto.toFixed(2).replace('.', ',')}%</td>
        <td>${e.pregao || '-'}</td>
        <td class="text-right">${e.itemPregao || '-'}</td>
        <td class="text-right">${e.quantidadePregao || '-'}</td>
        <td>${e.naturezaDespesa || '-'}</td>
        <td class="text-right">${formatarMoeda(e.valorTotalEmpenho)}</td>
        <td class="text-center">
          <button class="btn-small" onclick="removerEmpenho(${i})" title="Remover Empenho">X</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Remove empenho do fornecedor atual
  function removerEmpenho(index) {
    if (fornecedorAtualIndex === null) return;
    if (confirm('Deseja remover este empenho?')) {
      fornecedores[fornecedorAtualIndex].empenhos.splice(index, 1);
      atualizarTabelaEmpenhos();
    }
  }

  // Fecha modal ao clicar fora do conteúdo
  window.onclick = function(event) {
    const modal = document.getElementById('modalEmpenhos');
    if (event.target === modal) {
      fecharModalEmpenhos();
    }
  };

  // Inicializa lista fornecedores vazia
  atualizarListaFornecedores();
</script>

</body>
</html>
